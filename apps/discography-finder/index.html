<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–æ–∏—Å–∫–æ–≤–∏–∫ –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–π –∞—Ä—Ç–∏—Å—Ç–æ–≤ | –í–ª–∞–¥–∏–º–∏—Ä –ú–æ–¥–µ–Ω–æ–≤</title>
  <meta name="description" content="–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ —Å—Ç—É–¥–∏–π–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤ –ø–æ –í–∏–∫–∏–ø–µ–¥–∏–∏ –∏ Discogs. –í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π Discogs —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞." />
  <meta name="keywords" content="–¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏—è, —Å—Ç—É–¥–∏–π–Ω—ã–µ –∞–ª—å–±–æ–º—ã, –ø–æ–∏—Å–∫, –º—É–∑—ã–∫–∞, Wikipedia, Discogs, –í–ª–∞–¥–∏–º–∏—Ä –ú–æ–¥–µ–Ω–æ–≤" />
  <meta name="author" content="–í–ª–∞–¥–∏–º–∏—Ä –ú–æ–¥–µ–Ω–æ–≤" />
  <meta property="og:title" content="–ü–æ–∏—Å–∫–æ–≤–∏–∫ –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–π –∞—Ä—Ç–∏—Å—Ç–æ–≤" />
  <meta property="og:description" content="–ü–æ–∏—Å–∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Å—Ç—É–¥–∏–π–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤ –∞—Ä—Ç–∏—Å—Ç–æ–≤ –Ω–∞ Wikipedia. –ü–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ Discogs –ø—Ä–∏ –≤–≤–æ–¥–µ –ª–∏—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ru_RU" />
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéµ</text></svg>">
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #222;
      --muted: #666;
      --brand: #0a7bff;
      --brand-2: #085ec2;
      --ring: 0 0 0 6px rgba(10,123,255,0.12);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
      display: grid; grid-template-rows: 1fr auto;
    }
    .container { display: grid; place-items: center; padding: 40px 16px; }
    .shell { width: min(920px, 100%); text-align: center; }
    h1 { font-size: clamp(1.6rem, 2.5vw, 2.2rem); margin: 0 0 12px; }
    p.lead { margin: 0 0 24px; color: var(--muted); }

    .search-card {
      background: var(--card); border-radius: 20px; padding: 24px; box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    }
    .inputs { display: grid; gap: 12px; margin-top: 8px; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; }
    .input, .btn { border: 2px solid #e9e9f2; outline: none; border-radius: 999px; padding: 14px 18px; font-size: 1.05rem; }
    .input:focus { border-color: var(--brand); box-shadow: var(--ring); }
    .btn { background: var(--brand); color: #fff; cursor: pointer; padding-inline: 24px; transition: background .2s ease; }
    .btn:hover { background: var(--brand-2); }
    .token-row { grid-template-columns: 1fr auto; }
    .token-note { font-size: .9rem; color: var(--muted); text-align: left; margin-top: 8px; }
    details.instructions { margin-top: 10px; text-align: left; background: #fafafe; border: 1px solid #ececf6; border-radius: 14px; padding: 12px 14px; }
    summary { cursor: pointer; font-weight: 600; }

    .results { margin-top: 24px; text-align: left; display: grid; gap: 10px; }
    .album { background: var(--card); border: 1px solid #ececf6; border-radius: 14px; padding: 14px 16px; display: grid; gap: 6px; }
    .album-header { display: flex; flex-wrap: wrap; align-items: baseline; gap: 8px; }
    .album-title { font-weight: 700; }
    .meta { color: var(--muted); font-size: .95rem; }
    .links a { color: var(--brand); text-decoration: none; margin-right: 14px; }
    .links a:hover { text-decoration: underline; }

    .status { margin-top: 14px; color: var(--muted); font-size: .95rem; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #eef6ff; color: #0a5ec0; font-size: .8rem; margin-left: 6px; }

    footer { text-align: center; padding: 18px; color: var(--muted); border-top: 1px solid #ececf6; background: #fafafe; }
  </style>
</head>
<body>
  <main class="container">
    <div class="shell">
      <h1>–ü–æ–∏—Å–∫ —Å—Ç—É–¥–∏–π–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤ –∞—Ä—Ç–∏—Å—Ç–∞</h1>
      <p class="lead">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, <em>Placebo</em> –∏–ª–∏ <em>Depeche Mode</em>). –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ Wikipedia (EN). –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π —Ç–æ–∫–µ–Ω Discogs ‚Äî –¥–æ–±–∞–≤–∏–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–ª–∏–∑—ã –≤ Discogs.</p>

      <section class="search-card" aria-label="–ü–æ–∏—Å–∫–æ–≤–∞—è —Ñ–æ—Ä–º–∞">
        <div class="inputs">
          <div class="row">
            <input id="artistInput" class="input" type="search" placeholder="–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞‚Ä¶" aria-label="–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞" />
            <button id="searchBtn" class="btn" type="button">–ò—Å–∫–∞—Ç—å</button>
          </div>

          <div class="row token-row">
            <input id="tokenInput" class="input" type="password" placeholder="Discogs Personal Access Token (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" aria-label="Discogs token" />
            <button id="saveTokenBtn" class="btn" type="button" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
          <div class="token-note">–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (LocalStorage). –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ Wikipedia. <span class="badge" title="–ë–µ–∑–æ–ø–∞—Å–Ω–æ">read-only</span></div>

          <details class="instructions">
            <summary>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω Discogs?</summary>
            <ol>
              <li>–í–æ–π–¥–∏—Ç–µ –Ω–∞ <strong>discogs.com</strong> –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.</li>
              <li>–û—Ç–∫—Ä–æ–π—Ç–µ <em>Settings ‚Üí Developers</em> –∏ –Ω–∞–∂–º–∏—Ç–µ <em>Generate new token</em>.</li>
              <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É —Ç–æ–∫–µ–Ω–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ –ø–æ–ª–µ –≤—ã—à–µ, –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª.</li>
            </ol>
            <p class="meta">–¢–æ–∫–µ–Ω –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –ø–æ–∏—Å–∫—É (read-only). –ï—Å–ª–∏ –≤—Å—Ç–∞–≤–∏—Ç–µ –µ–≥–æ –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ ‚Äî —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–æ–∫–µ–Ω–∞ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏.</p>
          </details>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>
      </section>

      <section id="results" class="results" aria-label="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã"></section>
    </div>
  </main>

  <footer>
    –ü–æ–∏—Å–∫–æ–≤–∏–∫ –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–π –∞—Ä—Ç–∏—Å—Ç–æ–≤ –í–ª–∞–¥–∏–º–∏—Ä–∞ –ú–æ–¥–µ–Ω–æ–≤–∞ ¬© <span id="year"></span>
  </footer>

  <script>
    // ==========================
    // –£—Ç–∏–ª–∏—Ç—ã
    // ==========================
    const $ = (sel) => document.querySelector(sel);

    const state = {
      token: '',
      artist: '',
      wikiPageId: null,
      albums: [], // { title, year?, wikiUrl?, discogsUrl? }
    };

    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
    function loadToken() {
      const saved = localStorage.getItem('discogs_token_v1');
      if (saved) {
        state.token = saved;
        const input = $('#tokenInput');
        input.value = saved;
        input.type = 'password';
      }
    }

    function saveToken() {
      const val = $('#tokenInput').value.trim();
      state.token = val;
      if (val) localStorage.setItem('discogs_token_v1', val); else localStorage.removeItem('discogs_token_v1');
      setStatus(val ? '–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.' : '–¢–æ–∫–µ–Ω –æ—á–∏—â–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ Wikipedia.');
    }

    function setStatus(msg) { $('#status').textContent = msg || ''; }

    function toTitle(str) { return (str || '').replace(/_/g, ' ').trim(); }

    // –£–¥–∞–ª—è–µ–º —Å–∫–æ–±–æ—á–Ω—ã–µ –ø–æ–º–µ—Ç–∫–∏ –≤–∏–¥–∞ "(album)", "(Artist album)" –∏ —Ç.–ø. –∏ –ø–æ—Ö–æ–∂–∏–µ —Ö–≤–æ—Å—Ç—ã
    function cleanAlbumTitle(title) {
      if (!title) return '';
      return String(title)
        // –ª—é–±—ã–µ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å–ª–æ–≤–æ "album"
        .replace(/\s*\([^)]*\balbum\b[^)]*\)\s*/gi, ' ')
        // —Ä–µ–¥–∫–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è —Ö–≤–æ—Å—Ç—ã ‚Äî —Ç–∏—Ä–µ –∏–ª–∏ –¥–µ—Ñ–∏—Å + album
        .replace(/\s*[-‚Äî‚Äì]\s*album\b/gi, ' ')
        // –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ —Å –ø–æ–º–µ—Ç–∫–æ–π album
        .replace(/\s*\[[^\]]*\balbum\b[^\]]*\]\s*/gi, ' ')
        // —Å—Ö–ª–æ–ø—ã–≤–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        .replace(/\s{2,}/g, ' ')
        .trim();
    }

    function uniqueBy(arr, keyFn) {
      const seen = new Set();
      return arr.filter((x) => { const k = keyFn(x); if (seen.has(k)) return false; seen.add(k); return true; });
    }

    // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ Discogs: –∞–±—Å–æ–ª—é—Ç–Ω–∞—è https + –ª–æ–∫–∞–ª—å /ru/
    function normalizeDiscogsUri(uri) {
      if (!uri) return null;
      let out = uri;
      if (out.startsWith('/')) out = 'https://www.discogs.com' + out;
      out = out.replace(/^http:\/\//i, 'https://');
      // –≤—Å—Ç–∞–≤–ª—è–µ–º /ru/ –ø–æ—Å–ª–µ –¥–æ–º–µ–Ω–∞, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç (–∏ –µ—Å–ª–∏ —É–∂–µ –Ω–µ —Å—Ç–æ–∏—Ç –¥—Ä—É–≥–∞—è –ª–æ–∫–∞–ª—å)
      out = out.replace(/^https:\/\/www\.discogs\.com\/(?!ru\/)(?=master|artist|release|label|search|sell|user)/i, 'https://www.discogs.com/ru/');
      return out;
    }

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ JSON —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    async function fetchJSON(url, opts = {}, timeoutMs = 20000) {
      const ctrl = new AbortController();
      const id = setTimeout(() => ctrl.abort(), timeoutMs);
      try {
        const res = await fetch(url, { ...opts, signal: ctrl.signal });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return await res.json();
      } finally { clearTimeout(id); }
    }

    // ==========================
    // Wikipedia: –ø–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ "Studio albums"
    // ==========================
    async function findDiscographyPage(artist) {
      const searchUrl = `https://en.wikipedia.org/w/api.php?action=query&origin=*&format=json&list=search&srsearch=${encodeURIComponent(artist + ' discography')}&srlimit=5`;
      const data = await fetchJSON(searchUrl);
      const hit = (data.query.search || []).find(s => /discography/i.test(s.title));
      if (hit) return hit.pageid;

      const pageUrl = `https://en.wikipedia.org/w/api.php?action=query&origin=*&format=json&titles=${encodeURIComponent(artist)}&prop=info`;
      const pageData = await fetchJSON(pageUrl);
      const pages = pageData.query.pages;
      const first = Object.keys(pages)[0];
      return Number(first) > 0 ? Number(first) : null;
    }

    async function getStudioSectionIndex(pageId) {
      const url = `https://en.wikipedia.org/w/api.php?action=parse&origin=*&format=json&pageid=${pageId}&prop=sections`;
      const data = await fetchJSON(url);
      const sections = data.parse?.sections || [];
      const target = sections.find(s => /studio albums/i.test(s.line));
      return target ? Number(target.index) : null;
    }

    async function parseStudioAlbums(pageId, sectionIndex) {
      const url = `https://en.wikipedia.org/w/api.php?action=parse&origin=*&format=json&pageid=${pageId}&prop=text&section=${sectionIndex}`;
      const data = await fetchJSON(url);
      const html = data.parse?.text?.['*'] || '';
      const div = document.createElement('div');
      div.innerHTML = html;

      const albums = [];

      // 1) –¢–∞–±–ª–∏—Ü—ã –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–π (wikitable)
      div.querySelectorAll('table.wikitable').forEach(tbl => {
        const rows = Array.from(tbl.querySelectorAll('tr'));
        rows.slice(1).forEach(tr => {
          const link = tr.querySelector('i a, td a');
          if (link && link.getAttribute('href')?.startsWith('/wiki/')) {
            let title = link.getAttribute('title') || link.textContent.trim();
            const yearMatch = tr.textContent.match(/\b(19\d{2}|20\d{2})\b/);
            const year = yearMatch ? yearMatch[0] : undefined;
            albums.push({
              title: cleanAlbumTitle(title),
              year,
              wikiUrl: new URL(link.getAttribute('href'), 'https://en.wikipedia.org').toString(),
            });
          }
        });
      });

      // 2) –ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ (—Ä–µ–¥–∫–æ, –Ω–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è)
      div.querySelectorAll('ul > li').forEach(li => {
        const link = li.querySelector('i a, a');
        if (link && link.getAttribute('href')?.startsWith('/wiki/')) {
          let title = link.getAttribute('title') || link.textContent.trim();
          const yearMatch = li.textContent.match(/\b(19\d{2}|20\d{2})\b/);
          const year = yearMatch ? yearMatch[0] : undefined;
          if (/album/i.test(title) || /\balbum\b/i.test(li.textContent)) {
            albums.push({
              title: cleanAlbumTitle(title),
              year,
              wikiUrl: new URL(link.getAttribute('href'), 'https://en.wikipedia.org').toString(),
            });
          }
        }
      });

      // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –æ—á–∏—â–µ–Ω–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é
      return uniqueBy(albums, a => a.title.toLowerCase());
    }

    async function fetchWikipediaAlbums(artist) {
      const pageId = await findDiscographyPage(artist);
      if (!pageId) return [];
      const sectionIdx = await getStudioSectionIndex(pageId);
      if (!sectionIdx) return [];
      return await parseStudioAlbums(pageId, sectionIdx);
    }

    // ==========================
    // Discogs: –ø–æ–∏—Å–∫ master-–∑–∞–ø–∏—Å–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–µ—Å–ª–∏ –≤–≤–µ–¥—ë–Ω —Ç–æ–∫–µ–Ω)
    // ==========================
    async function fetchDiscogsLink(artist, albumTitle, token) {
      if (!token) return null;
      const url = new URL('https://api.discogs.com/database/search');
      url.searchParams.set('type', 'master');
      url.searchParams.set('format', 'Album');
      url.searchParams.set('artist', artist);
      url.searchParams.set('release_title', albumTitle);
      url.searchParams.set('per_page', '5');
      url.searchParams.set('page', '1');
      url.searchParams.set('token', token);

      try {
        const data = await fetchJSON(url.toString());
        const results = data.results || [];
        if (!results.length) return null;
        const uri = results[0]?.uri || results[0]?.master_url || results[0]?.resource_url || null;
        return normalizeDiscogsUri(uri);
      } catch (e) {
        console.warn('Discogs error for', albumTitle, e);
        return null;
      }
    }

    async function enrichWithDiscogs(albums, artist, token) {
      if (!token) return albums;
      const concurrency = 4;
      const queue = albums.map((_, i) => i);
      async function worker() {
        while (queue.length) {
          const idx = queue.shift();
          const a = albums[idx];
          const link = await fetchDiscogsLink(artist, a.title, token);
          a.discogsUrl = link || undefined;
        }
      }
      await Promise.all(Array.from({ length: concurrency }, worker));
      return albums;
    }

    // ==========================
    // –†–µ–Ω–¥–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    // ==========================
    function renderAlbums(albums, artist) {
      const box = $('#results');
      box.innerHTML = '';
      if (!albums.length) {
        box.innerHTML = '<p class="meta">–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ä–∞–∑–¥–µ–ª ¬´Studio albums¬ª –Ω–∞ Wikipedia –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "<em>' + artist + ' discography</em>").</p>';
        return;
      }
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–æ–¥—É, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
      albums.sort((a,b) => (a.year||'9999').localeCompare(b.year||'9999'));
      for (const a of albums) {
        const el = document.createElement('article');
        el.className = 'album';
        el.innerHTML = `
          <div class="album-header">
            <span class="album-title">${a.title}</span>
            ${a.year ? `<span class="meta">(${a.year})</span>` : ''}
          </div>
          <div class="links">
            ${a.wikiUrl ? `<a href="${a.wikiUrl}" target="_blank" rel="noopener nofollow">Wikipedia</a>` : ''}
            ${a.discogsUrl ? `<a href="${a.discogsUrl}" target="_blank" rel="noopener nofollow">Discogs</a>` : '<span class="meta">Discogs: –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π</span>'}
          </div>`;
        box.appendChild(el);
      }
    }

    // ==========================
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    // ==========================
    async function handleSearch() {
      const artist = $('#artistInput').value.trim();
      if (!artist) { setStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞—Ä—Ç–∏—Å—Ç–∞.'); return; }
      setStatus('–ò—â—É —Å—Ç—É–¥–∏–π–Ω—ã–µ –∞–ª—å–±–æ–º—ã –Ω–∞ Wikipedia‚Ä¶');
      $('#results').innerHTML = '';

      try {
        const wikiAlbums = await fetchWikipediaAlbums(artist);
        setStatus(`–ù–∞–π–¥–µ–Ω–æ –Ω–∞ Wikipedia: ${wikiAlbums.length}. ${state.token ? '–î–æ–±–∞–≤–ª—è—é —Å—Å—ã–ª–∫–∏ Discogs‚Ä¶' : 'Discogs –æ—Ç–∫–ª—é—á—ë–Ω (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞).'}`);

        const withDiscogs = await enrichWithDiscogs(wikiAlbums, artist, state.token);
        renderAlbums(withDiscogs, artist);
        setStatus(`–ì–æ—Ç–æ–≤–æ: ${withDiscogs.length} –∞–ª—å–±–æ–º(–æ–≤). –ò—Å—Ç–æ—á–Ω–∏–∫: Wikipedia${state.token ? ' + Discogs' : ''}.`);
      } catch (e) {
        console.error(e);
        setStatus('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.');
        $('#results').innerHTML = '<p class="meta">–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
      }
    }

    // –°–æ–±—ã—Ç–∏—è
    $('#searchBtn').addEventListener('click', handleSearch);
    $('#artistInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') handleSearch(); });
    $('#saveTokenBtn').addEventListener('click', saveToken);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    loadToken();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <script src="/js/yandex_counter.js"></script>
  
</body>
</html>
